(this["webpackJsonpsignature-templater"]=this["webpackJsonpsignature-templater"]||[]).push([[0],{11:function(e,t,n){e.exports={app:"Main_app__1unYv",row:"Main_row__117Qf","buttons-row":"Main_buttons-row__139-5","go-button":"Main_go-button__2SQGC","bpk-no-touch-support":"Main_bpk-no-touch-support__2w3fM",column:"Main_column__2wbMz","bpk-keyframe-spin":"Main_bpk-keyframe-spin__c05yu"}},18:function(e,t,n){e.exports={input:"Input_input__267Jt",input__button:"Input_input__button__jcXfw","bpk-no-touch-support":"Input_bpk-no-touch-support__xiVno","input-wrapper":"Input_input-wrapper__2t4Nb",label:"Input_label__2uf_I","bpk-keyframe-spin":"Input_bpk-keyframe-spin__2tYfa"}},19:function(e,t,n){e.exports={app:"Form_app__2kLDl",row:"Form_row__1PYqe",form__row:"Form_form__row__DCI-R","buttons-row":"Form_buttons-row__1ADLz","go-button":"Form_go-button__2Mt1W","bpk-no-touch-support":"Form_bpk-no-touch-support__18gD-",column:"Form_column__34yFM","bpk-keyframe-spin":"Form_bpk-keyframe-spin__1UyB5"}},20:function(e,t,n){e.exports={list:"List_list__2lpsf","list-item":"List_list-item__IE356",anchor:"List_anchor__3_1JC","bpk-no-touch-support":"List_bpk-no-touch-support__1hKA7","bpk-keyframe-spin":"List_bpk-keyframe-spin__1nIuw"}},23:function(e,t,n){e.exports={button:"Button_button__30zzF","bpk-no-touch-support":"Button_bpk-no-touch-support__2JIPM","button--secondary":"Button_button--secondary__3Pvzj","bpk-keyframe-spin":"Button_bpk-keyframe-spin__gbdHq"}},24:function(e,t,n){e.exports={modal:"StoredFileSelectorModal_modal__2p1he","fade-in":"StoredFileSelectorModal_fade-in__fE-dN","fade-out":"StoredFileSelectorModal_fade-out__Nc8v8"}},27:function(e,t,n){e.exports={highlighter:"HTMLPreview_highlighter__1YG42","fade-in-out":"HTMLPreview_fade-in-out__1_qCo","done-wrapper":"HTMLPreview_done-wrapper__1kpqy"}},31:function(e,t,n){e.exports={spinner:"Spinner_spinner__1Zr7I",rotate:"Spinner_rotate__fpSR2"}},34:function(e){e.exports=JSON.parse('{"span":{"id":"id","params":["innerHTML"]},"a":{"id":"title","params":["href","innerHTML"]},"img":{"id":"alt","params":["src",{"name":"width","related":"height","relation":"maintainRatio"},{"name":"height","related":"width","relation":"maintainRatio"}]}}')},38:function(e,t,n){e.exports=n(52)},43:function(e,t,n){},52:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(30),o=n.n(i),c=(n(43),n(22)),l=n(14),s=n(1),u=n.n(s),p=n(5),f=n(3),m=n(4),h=n(8),d=n(7),v=n(9),g=n(15),b=n(23),y=n.n(b),_=function(e){var t=e.className,n=e.secondary,a=Object(g.a)(e,["className","secondary"]),i=[y.a.button,n?y.a["button--secondary"]:"",t];return r.a.createElement("button",Object.assign({},a,{className:i.join(" ")}))};_.defaultProps={secondary:!1,className:"",onClick:function(){}};var O=_,w=O,j=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).onButtonClick=function(){n.inputRef.current&&n.inputRef.current.click()},n.inputRef=r.a.createRef(),n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props,t=e.onFileSelected,n=e.children,i=Object(g.a)(e,["onFileSelected","children"]);return r.a.createElement(a.Fragment,null,r.a.createElement(O,Object.assign({onClick:this.onButtonClick},i),n),r.a.createElement("input",{onChange:t,ref:this.inputRef,id:"file-input",type:"file",name:"file",style:{display:"none"}}))}}]),t}(a.Component),k=n(18),E=n.n(k),S={CONFIRMATION:"confirmation"},F=function(e,t){var n=e.className,a=e.labelText,i=e.type,o=e.onFinishedClick,c=Object(g.a)(e,["className","labelText","type","onFinishedClick"]),l=[E.a.input,n];return r.a.createElement("div",null,r.a.createElement("label",{className:E.a.label},a),r.a.createElement("div",{className:E.a["input-wrapper"]},r.a.createElement("input",Object.assign({},c,{ref:t,className:l.join(" ")})),i===S.CONFIRMATION&&r.a.createElement("button",{className:E.a.input__button,onClick:o},r.a.createElement("span",{role:"img","aria-label":"done"},"\ud83d\udc4d"))))};F.defaultTypes={className:"",type:null};var x=r.a.forwardRef(F),C=S,N=x,M=function(){function e(){Object(f.a)(this,e)}return Object(m.a)(e,null,[{key:"loadFromURL",value:function(e){return fetch(e,{method:"GET",mode:"cors",headers:{Origin:window.location.origin}}).then((function(e){return e.text()}))}},{key:"loadFromFile",value:function(){var e=Object(p.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(!window.FileReader)return n("Cannot read files with this browser");var a,r,i=new FileReader;i.onload=function(t){console.log(t),a||(console.log("Started loading file"),a=Date.now()),2===i.readyState&&(r=Date.now(),console.log("File loaded in:",r-a,"milliseconds"),e((i.result||{}).toString()))},i.readAsText(t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),I=n(31),P=n.n(I),T=function(){return r.a.createElement("span",{className:P.a.spinner,role:"img","aria-label":"spinner"},"\ud83c\udf00")},R=function(){function e(t){Object(f.a)(this,e),this.filesIndex="index",this.storage=t}return Object(m.a)(e,[{key:"save",value:function(){var e=Object(p.a)(u.a.mark((function e(t,n){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.storage.setItem(t,n),(a=this.storage.getItem(this.filesIndex)||"")?(-1===a.indexOf(t)&&(a="".concat(a,",").concat(t)),this.storage.setItem(this.filesIndex,a)):this.storage.setItem(this.filesIndex,t);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(p.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storage.getItem(t)||"");case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAllFileNames",value:function(){var e=Object(p.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.storage.getItem(this.filesIndex)||"").split(","));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();var L=function(e){var t=new R(localStorage);return function(n){return r.a.createElement(e,Object.assign({},n,{storage:t}))}},D=n(11),B=n.n(D),A=n(20),H=n.n(A),U=function(e){var t=e.elements,n=e.onItemClick;return r.a.createElement("ul",{className:H.a.list},t.map((function(e,t){return r.a.createElement("div",{key:e,className:H.a.anchor,role:"button",onClick:function(){return n(t)}},r.a.createElement("li",{className:H.a["list-item  "]},e))})))},J=L(function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={filenames:[]},n.onSelect=function(e){n.props.onSelect(n.state.filenames[e])},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.state.filenames;return r.a.createElement(U,{elements:e,onItemClick:this.onSelect})}},{key:"componentDidMount",value:function(){var e=Object(p.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(this.props),e.next=3,this.props.storage.getAllFileNames();case 3:t=e.sent,this.setState({filenames:t});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}(a.Component)),z=n(24),G=n.n(z),Y=function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={closing:!1},n.closeAndCall=function(e){return function(t){n.setState({closing:!0},(function(){setTimeout(e,300,t)}))}},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props,t=e.onSelect,n=e.onClose,a=this.state.closing;return r.a.createElement("div",{className:[G.a.modal,a&&G.a["fade-out"]].join(" ")},r.a.createElement(w,{onClick:this.closeAndCall(n)},"Close"),r.a.createElement(J,{onSelect:this.closeAndCall(t)}))}}]),t}(a.Component),q=function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).inputRef=r.a.createRef(),n.state={filenameSelected:null,savingFile:!1,isModalOpen:!1},n.onFileSelected=function(e){var t=e.target.files[0];n.setState({savingFile:!0},Object(p.a)(u.a.mark((function e(){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.loadFromFile(t);case 2:return a=e.sent,e.next=5,n.props.storage.save(t.name,a);case 5:n.setState({savingFile:!1,filenameSelected:t.name});case 6:case"end":return e.stop()}}),e)}))))},n.clearSelectedFile=function(){n.setState({filenameSelected:null})},n.onURLFinished=function(){if(n.inputRef.current){var e=n.inputRef.current.value;n.setState({savingFile:!0},Object(p.a)(u.a.mark((function t(){var a,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M.loadFromURL(e);case 2:return a=t.sent,r=e.split("/").pop(),t.next=6,n.props.storage.save(r,a);case 6:n.setState({savingFile:!1,filenameSelected:r});case 7:case"end":return t.stop()}}),t)}))))}},n.switchModalState=function(){n.setState({isModalOpen:!n.state.isModalOpen})},n.handleFileSelectedFromStorage=function(){var e=Object(p.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.setState({filenameSelected:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.navigateForward=function(){n.state.filenameSelected&&n.props.history.push("/form?file=".concat(n.state.filenameSelected))},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.state,t=e.savingFile,n=e.filenameSelected,i=e.isModalOpen;return r.a.createElement("div",{className:B.a.app},r.a.createElement("div",{className:B.a.column},r.a.createElement("h1",null,"Suilabs Signature templater app")),r.a.createElement("div",{className:B.a.column},t?r.a.createElement("div",{className:B.a.row},r.a.createElement(T,null)):n?r.a.createElement("div",{className:B.a.row},r.a.createElement("h3",null,"File selected: ",n)):r.a.createElement(a.Fragment,null,r.a.createElement("div",{className:B.a.row},r.a.createElement("h2",null,"Use one of the options below to start with.")),r.a.createElement("div",{className:B.a.row},r.a.createElement(j,{secondary:!0,onFileSelected:this.onFileSelected},"1. UploadTemplate")),r.a.createElement("div",{className:B.a.row},r.a.createElement(N,{type:C.CONFIRMATION,ref:this.inputRef,onFinishedClick:this.onURLFinished,labelText:"2. Template Url"})),r.a.createElement("div",{className:B.a.row},r.a.createElement(w,{secondary:!0,onClick:this.switchModalState},"3. Choose Stored Template"))),r.a.createElement("div",{className:[B.a.row,n&&B.a["buttons-row"]].join(" ")},n&&r.a.createElement(w,{onClick:this.clearSelectedFile},"Back"),r.a.createElement(w,{onClick:this.navigateForward,disabled:!n},"GO!"))),i&&r.a.createElement(Y,{opened:!1,onSelect:this.handleFileSelectedFromStorage,onClose:this.switchModalState}))}}]),t}(a.Component),W=Object(l.f)(L(q)),Q=n(16),X=n(36),K=n(34),V=n(37),Z=n(35),$=n.n(Z);function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(n,!0).forEach((function(t){Object(Q.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ne=function(){function e(t){Object(f.a)(this,e),this.maintainRatio=function(e,t,n){var a=e[t]/e[n];return function(t){var r=Math.round(t/a);return{key:"".concat(e.id,"|").concat(n),value:r}}},this.config=t,this.relationsMap=new Map,this.relationsMap.set("maintainRatio",this.maintainRatio)}return Object(m.a)(e,[{key:"parseContent",value:function(e){var t=this,n=document.createElement("div");n.innerHTML=e;var a=[];return Object.keys(this.config).forEach((function(e){var r=n.getElementsByTagName(e),i=!0,o=!1,c=void 0;try{for(var l,s=r[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var u=l.value,p=t.extractElementInformation(u,n);a.push.apply(a,Object(V.a)(p))}}catch(f){o=!0,c=f}finally{try{i||null==s.return||s.return()}finally{if(o)throw c}}})),a.sort((function(e,t){return e.position-t.position})),{fields:a,html:n.innerHTML}}},{key:"extractElementInformation",value:function(e,t){var n=this,a=e.tagName.toLowerCase(),r=this.config[a],i=r.id,o=r.params;!e.id&&e[i]?e.id=e[i]:e.id=$()();var c=t.innerHTML.indexOf(e.id);return o.map((function(t){var r={id:e.id,tag:a,position:c};return r=te({},r,{},"string"===typeof t?n.resolveStringParam(e,t):n.resolveObjectParam(e,t))}))}},{key:"resolveStringParam",value:function(e,t){return{param:t,value:e[t].replace(/[\t\n]/g,"")}}},{key:"resolveObjectParam",value:function(e,t){var n,a=e[t.name];if(!Object.getOwnPropertyNames(this).includes(t.relation))throw new Error("function '".concat(t.relation,"' not implemented"));var r=this.relationsMap.get(t.relation);return r&&(n=r(e,t.name,t.related)),{param:t.name,value:a,func:n}}}]),e}(),ae=n(27),re=n.n(ae);function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var oe=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).displayNewTemplate=function(){window.open().document.write(n.state.fragment.innerHTML)},n.state={fragment:document.createElement("div"),elementsById:{}},n.highlighter=r.a.createRef(),n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t,n=this,a=this.state,r=a.fragment,i=a.elementsById;if(e.html){r.innerHTML=e.html;var o=!0,c=!1,l=void 0;try{for(var s,u=r.getElementsByTagName("*")[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var p=s.value;"IMG"===p.tagName&&p.addEventListener("load",(function(){console.log("finished loading"),n.forceUpdate()})),i[p.id]=p}}catch(f){c=!0,l=f}finally{try{o||null==u.return||u.return()}finally{if(c)throw l}}t={fragment:r}}e.vars.forEach((function(e){var t=e.id,n=e.param,a=e.value;i[t][n]=a})),(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(n,!0).forEach((function(t){Object(Q.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{elementsById:i}))&&this.setState(t)}},{key:"render",value:function(){if(!this.props.html)return"";var e=this.state.fragment;return r.a.createElement("div",null,r.a.createElement("div",{className:re.a.highlighter,ref:this.highlighter}),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.innerHTML}}),r.a.createElement("div",{className:re.a["done-wrapper"]},r.a.createElement(w,{onClick:this.displayNewTemplate},"Done")))}},{key:"componentDidUpdate",value:function(){var e=this;this.highlighter.current&&this.props.changed?setTimeout((function(){var t=e.highlighter.current||{},n=document.getElementById(e.props.changed),a=function(e){if(!e)return{top:0,left:0};var t=e.getBoundingClientRect(),n=window.pageXOffset||(document.documentElement||{}).scrollLeft,a=window.pageYOffset||(document.documentElement||{}).scrollTop;return{top:t.top+a,left:t.left+n}}(n);t.style.top="".concat(a.top,"px"),t.style.left="".concat(a.left,"px"),t.style.height="".concat((n||{}).offsetHeight,"px"),t.style.width="".concat((n||{}).offsetWidth,"px"),t.style.opacity="1"}),250):this.highlighter.current&&!this.props.changed&&(this.highlighter.current.style.opacity="0")}}]),t}(a.Component);oe.defaultProps={html:"",vars:{}};var ce=oe,le=n(19),se=n.n(le);function ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var pe={a:"link",href:"url",img:"image",src:"source",innerHTML:"displayable text",width:"width",height:"height"},fe=function(e){return pe[e]||e},me=L(function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={fields:[],changed:null},n.parser=new ne(K),n.parseTemplate=function(){var e=Object(p.a)(u.a.mark((function e(t){var a,r,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new URLSearchParams(t.search),r=a.get("file"),e.next=4,n.props.storage.get(r);case 4:return i=e.sent,e.abrupt("return",n.parser.parseContent(i));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.inputChange=function(e){var t=e.target,a=t.name,r=t.value,i=a.split("|"),o=Object(X.a)(i,2),c=o[0],l=o[1],s=n.state.fields,u=s.findIndex((function(e){return e.id===c&&e.param===l}));s[u]=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ue(n,!0).forEach((function(t){Object(Q.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ue(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},s[u],{value:r}),n.setState({fields:s,changed:c})},n.relatedChange=function(e){return function(t){var a=t.target,r=a.name,i=a.value,o=e(i);n.inputChange({target:{name:r,value:i}}),n.inputChange({target:{name:o.key,value:o.value}})}},n.inputChangeFactory=function(e){return console.log(e),e?n.relatedChange(e):n.inputChange},n.clearChanged=function(){console.log("clear"),n.setState({changed:null})},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=Object(p.a)(u.a.mark((function e(){var t,n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parseTemplate(this.props.location);case 2:t=e.sent,n=t.fields,a=t.html,this.setState({fields:n,html:a});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.fields,a=t.html,i=t.changed;return r.a.createElement("div",{className:se.a.app},r.a.createElement("div",{className:se.a.column},r.a.createElement("h2",null,"Preview"),r.a.createElement(ce,{html:a,vars:n,changed:i})),r.a.createElement("div",{className:se.a.column},r.a.createElement("h2",null,"Template Data"),n.map((function(t){var n="".concat(t.id,"|").concat(t.param);return r.a.createElement("div",{key:n,className:se.a.form__row},r.a.createElement(N,{onChange:e.inputChangeFactory(t.func),onBlur:e.clearChanged,labelText:"".concat(fe(t.tag)," ").concat(fe(t.param)),name:n,value:t.value}))}))))}}]),t}(a.Component));o.a.render(r.a.createElement((function(){return r.a.createElement(c.a,null,r.a.createElement(l.c,null,r.a.createElement(l.a,{exact:!0,path:"/",component:W}),r.a.createElement(l.a,{exact:!0,path:"/form",component:me})))}),null),document.getElementById("root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.0c69b86d.chunk.js.map